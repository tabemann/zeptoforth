# SHA-256

There is currently a software implementation of SHA-256 for zeptoforth. This implementation does not take advantage of hardware SHA-256 accelerators, even though this is planned for future development.

Note that a basic limitation of SHA-256 is that the total data size must be smaller than 2^64 bits, i.e. 2^56 bytes. For most practical applications this should not be a problem.

The source code for the software implementation of SHA-256 is in `extra/common/sha256.fs`. This code is based closely off of https://github.com/amonsier/sha-2 which in turn is closely based off https://en.wikipedia.org/wiki/SHA-2 .

There is a set of SHA-256 tests in `test/common/sha256.fs`.

### `sha-256`

The `sha-256` module contains the following words:

##### `size-of-sha-256-hash`
( -- bytes )

Size of an SHA-256 hash in bytes

##### `sha-256-size`
( -- bytes )

Size of SHA-256 structure in bytes

##### `init-sha-256`
( hash sha-256 -- )

Initialize an SHA-256 streaming calculation.

- hash: address of hash array, where the result is delivered
- sha-256: address of an SHA-256 structure

If all the data you are calculating the hash value on is not available in a contiguous buffer in memory, this is where you should start. Instantiate a SHA-256 structure, and invoke this word. Once a SHA-256 hash has been calculated the SHA-256 structure can be initialized again for the next calculation.

##### `write-sha-256`
( data len sha-256 -- )

Stream more input for an on-going SHA-256 calculation.

- data: address of data to be added to the calculation
- len: length of the data to add, in bytes
- sha-256: address of a previously initialized SHA-256 structure

This word may be invoked an arbitrary number of times between initialization and closing, but the data length is limited by the SHA-256 algorithm: the total number of bits (i.e. the total number of bytes times eight) must be representable by a 64-bit unsigned integer. While that is not a practical limitation, the result is unpredictable if that limit is exceeded.

This word may be invoked on empty data (zero length), although that obviously will not add any data.

##### `close-sha-256`
( sha-256 -- )
  
Conclude an SHA-256 streaming calculation, making the hash value available.

- sha-256: address of a previously initialized SHA-256 structure

After this word has been invoked, the result is available in the hash buffer that initially was provided. The address of the hash value is returned for convenience, but you should feel free to drop it; it is simply the address of the first byte of your initially provided hash array.

Invoking this word for a calculation with no data (the writing function has never been invoked, or it only has been invoked with empty data) is legal. It will calculate the SHA-256 value of the empty string.

##### `calc-sha-256`
( input len hash -- )

The simple SHA-256 calculation word

- input: address of the data the hash will be calculated on
- len: length of the input data, in bytes
- hash: address of hash array, where the result is delivered

If all the data you are calculating the hash value on is available in a contiguous buffer in memory, this is the word you should use.

The length must be correspond to an unsigned 64-bit number of bits (i.e. the length times eight must be less than 2^64).
