
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Semaphore Words &#8212; zeptoforth  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Stream Words" href="stream.html" />
    <link rel="prev" title="Bidirectional Channel Words" href="rchannel.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="semaphore-words">
<h1>Semaphore Words<a class="headerlink" href="#semaphore-words" title="Permalink to this headline">¶</a></h1>
<p>A semaphore is a task synchronization construct which keeps a counter indicating some resource and, when the counter is negative, a queue of waiting tasks. Tasks can <em>give</em> a semaphore, which increments the counter, and if there one or more waiting tasks, readies the task that has been blocked the longest in an FIFO fashion. Note that a limit can be specified where <em>giving</em> a semaphore will not increase the counter beyond the specified limit. Tasks can also <em>take</em> a semaphore, which decrements the counter, and if afterwards the counter is negative, blocks the task and places it at the end of the queue of waiting tasks. Additionally there are operations for <em>ungiving</em> a semaphore, in the case where one needs to decrement the counter without potentially blocking the current task, and for <em>broadcasting</em> a semaphore, which is equivalent to <em>giving</em> each waiting task.</p>
<section id="sema">
<h2><code class="docutils literal notranslate"><span class="pre">sema</span></code><a class="headerlink" href="#sema" title="Permalink to this headline">¶</a></h2>
<p>The following words are in <code class="docutils literal notranslate"><span class="pre">sema</span></code>:</p>
<section id="sema-size">
<h3><code class="docutils literal notranslate"><span class="pre">sema-size</span></code><a class="headerlink" href="#sema-size" title="Permalink to this headline">¶</a></h3>
<p>( – bytes )</p>
<p>The size of a semaphore in bytes.</p>
</section>
<section id="no-sema-limit">
<h3><code class="docutils literal notranslate"><span class="pre">no-sema-limit</span></code><a class="headerlink" href="#no-sema-limit" title="Permalink to this headline">¶</a></h3>
<p>( – n )</p>
<p>Magic value indicating no semaphore limit.</p>
</section>
<section id="init-sema">
<h3><code class="docutils literal notranslate"><span class="pre">init-sema</span></code><a class="headerlink" href="#init-sema" title="Permalink to this headline">¶</a></h3>
<p>( limit counter addr – )</p>
<p>Initialize a semaphore at the specified address <em>addr</em>, which must have size <code class="docutils literal notranslate"><span class="pre">sema-size</span></code>, with <em>counter</em> as the initial counter and <em>limit</em> as the counter limit; a <em>limit</em> of <code class="docutils literal notranslate"><span class="pre">no-sema-limit</span></code> will disable counter limits.</p>
</section>
<section id="take">
<h3><code class="docutils literal notranslate"><span class="pre">take</span></code><a class="headerlink" href="#take" title="Permalink to this headline">¶</a></h3>
<p>( semaphore – )</p>
<p>Decrement the counter of a semaphore, blocking the current task if the counter after decrementing is negative; if a timeout is specified via the user variable <code class="docutils literal notranslate"><span class="pre">timeout</span></code> and the current task is not readied before the timeout is reached, the exception <code class="docutils literal notranslate"><span class="pre">x-timed-out</span></code> is raised (both <code class="docutils literal notranslate"><span class="pre">timeout</span></code> and <code class="docutils literal notranslate"><span class="pre">x-timed-out</span></code> are defined in <code class="docutils literal notranslate"><span class="pre">task</span></code>). This is not safe to call within an interrupt service routine or critical section.</p>
</section>
<section id="give">
<h3><code class="docutils literal notranslate"><span class="pre">give</span></code><a class="headerlink" href="#give" title="Permalink to this headline">¶</a></h3>
<p>( semaphore – )</p>
<p>Increment the counter of a semaphore, up to the counter limit if one is set; if one or more tasks are blocked on the semaphore, the one that has been blocked the longest is readied. This is not safe to call within an interrupt service routine or critical section.</p>
</section>
<section id="ungive">
<h3><code class="docutils literal notranslate"><span class="pre">ungive</span></code><a class="headerlink" href="#ungive" title="Permalink to this headline">¶</a></h3>
<p>( semaphore – )</p>
<p>Decrement the counter of a semaphore without blocking the current task. This is not safe to call within an interrupt service routine or critical section.</p>
</section>
<section id="broadcast">
<h3><code class="docutils literal notranslate"><span class="pre">broadcast</span></code><a class="headerlink" href="#broadcast" title="Permalink to this headline">¶</a></h3>
<p>( semaphore – )</p>
<p><em>Give</em> all of the tasks blocked on a semaphore. This is not safe to call within an interrupt service routine or critical section.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">zeptoforth</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="basic.html">Basic Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="module.html">Module Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="lambda.html">Lambda Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="wordlist.html">Wordlist Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="task.html">Multitasking Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="action.html">Action Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="pin.html">Pin Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="led.html">LED Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpio.html">GPIO Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="exti.html">EXTI Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="pio.html">Programmable Input/Output Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="uart.html">UART Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="adc.html">Analog-Digital Converter Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="spi.html">SPI Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="i2c.html">I2C Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="pwm.html">Pulse Width Modulation Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="rtc.html">Realtime Clock (RTC) Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="timer.html">Hardware Timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdcard.html">SDHC/SDXC Card Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="fat32.html">FAT32 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="simple_fat32.html">Simple FAT32 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="fat32_tools.html">FAT32 Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="interrupt.html">Interrupt Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="multicore.html">Multicore Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev_tools.html">Development Tools Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="armv6m.html">ARMv6-M Assembler Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="line.html">Line Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="double.html">Double-Cell Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="value.html">Value and Local Variable Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="closure.html">Closures</a></li>
<li class="toctree-l1"><a class="reference internal" href="temp.html">Temporary Buffer Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="task_pool.html">Task Pool words</a></li>
<li class="toctree-l1"><a class="reference internal" href="action_pool.html">Action Pool words</a></li>
<li class="toctree-l1"><a class="reference internal" href="heap.html">Heap Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="pool.html">Pool Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="map.html">Map Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="oo.html">Object Orientation</a></li>
<li class="toctree-l1"><a class="reference internal" href="lock.html">Lock Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="slock.html">Simple Lock Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="channel.html">Channel Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="fchannel.html">Rendezvous Channel Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="schannel.html">Simple channel Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="rchannel.html">Bidirectional Channel Words</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Semaphore Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="stream.html">Stream Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="tqueue.html">Task Queue Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="systick.html">SysTick Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="rng.html">Random Number Generator Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="ansi_term.html">ANSI Terminal words</a></li>
<li class="toctree-l1"><a class="reference internal" href="qspi.html">Quad SPI words</a></li>
<li class="toctree-l1"><a class="reference internal" href="block.html">Block words</a></li>
<li class="toctree-l1"><a class="reference internal" href="edit.html">Block Editor</a></li>
<li class="toctree-l1"><a class="reference internal" href="swd.html"><code class="docutils literal notranslate"><span class="pre">swdcom</span></code> Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Testing Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="internal.html">Internal Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="asm.html">Compilation-specific words</a></li>
<li class="toctree-l1"><a class="reference internal" href="expose.html">Exposed Kernel Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/display.html">Bitmaps and Displays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/font.html">Fonts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extra/neopixel.html">Neopixels on the RP2040</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="rchannel.html" title="previous chapter">Bidirectional Channel Words</a></li>
      <li>Next: <a href="stream.html" title="next chapter">Stream Words</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Travis Bemann.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/words/semaphore.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>